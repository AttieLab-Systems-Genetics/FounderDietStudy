---
title: "Time Measurements"
author: "Brian Yandell"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
runtime: shiny
params:
  echo: no
resource_files:
- traitData.rds
- traitSignal.rds
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
#devtools::install_github("byandell/foundr")
```

# Traits over time

```{r}
setwd("~/Documents/Research/attie_alan/FounderDietStudy/")
```

```{r}
traitData <- readRDS("traitData.rds")
traitSignal <- readRDS("traitSignal.rds")
```

```{r}
dtraits <- foundr::timetraits(traitSignal, "week")
```

```{r}
traitTime <- foundr::strain_time(traitData, traitSignal,
                           c("Physio: BW", "Physio: BL"),
                           "cellmean", "week")
```

```{r}
traitTime <- foundr::strain_time(traitData, traitSignal,
                           "Physio: BW",
                           "cellmean", "week")
```

```{r}
print(foundr::ggplot_strain_time(traitTime))
```

```{r}
print(foundr::ggplot_strain_time(traitTime, facet_strain = TRUE))
```

```{r}
print(foundr::ggplot_strain_time(traitTime,
  facet_strain = TRUE))
```

# Shiny Code

```{r}
shiny::fluidRow(
  shiny::column(
    3,
    shiny::selectInput("time", "Time Unit:", c("week", "minute"))),
  shiny::column(
    3,
    shiny::selectInput("trait", "Trait:", NULL)),
  shiny::column(
    3,
    shiny::checkboxInput("facet_strain", "Facet Strain?", FALSE)),
  shiny::column(
    3,
    shiny::selectInput("response", "Response:", c("value", "cellmean", "signal"))))
```

```{r}
timetraits <- shiny::reactive({
  shiny::req(input$time)
  foundr::timetraits(traitSignal, input$time)
})
```

```{r}
shiny::observeEvent(
  timetraits(),
  {
    shiny::updateSelectInput(
      session, "trait",
      choices = timetraits(),
      selected = timetraits()[1])
})
```

```{r}
traitTime <- shiny::reactive({
  shiny::req(input$trait, input$response, input$time)
  foundr::strain_time(
    traitData, traitSignal,
    input$trait, input$response, input$time)
})
```

```{r}
shiny::renderPlot({
  print(foundr::ggplot_strain_time(
    traitTime(),
    facet_strain = input$facet_strain))
})
```
